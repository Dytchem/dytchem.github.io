<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>诗词空间</title>
    <style>
        body {
            background-color: #f5f5f5;
            color: #333;
            font-family: '宋体', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            transition: all 0.3s ease;
        }

        header {
            padding: 1em 0;
        }

        h1,
        h3 {
            /* font-size: 2em; */
            margin: 0 auto;
            text-align: center;
            font-family: 'Times New Roman', sans-serif;
        }

        .poetry-card {
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin: 1em auto;
            max-width: 800px;
            padding: 1em;
            transition: all 0.3s ease;
        }

        .card-title {
            text-align: center;
            font-size: 1.5em;
            margin: 0 auto 0.5em auto;
            /* 减少底部 margin */
            transition: all 0.3s ease;
            font-family: '黑体', sans-serif;
        }

        .card-time {
            text-align: center;
            font-size: 0.8em;
            color: #666;
            margin-top: 0.2em;
            /* 减少顶部 margin */
        }

        .card-content {
            text-align: center;
            display: none;
            font-size: 1.2em;
            margin-top: 1em;
            transition: all 0.3s ease;
        }

        .card-content p {
            font-family: '宋体', serif;
        }

        @media screen and (max-width: 600px) {
            header h1 {
                font-size: 1.5em;
            }

            .poetry-card {
                padding: 0.5em;
            }

            .card-title {
                font-size: 1.2em;
            }

            .card-content {
                font-size: 1em;
            }
        }
    </style>
</head>

<body>
    <header>
        <h1>Dytchem的诗词空间</h1>
    </header>
    <div id="poetry-container"></div>
    <footer>
        <h3>&copy; 2024 Dychem. All rights reserved.</h3>
    </footer>
    <script>
        // 获取诗歌容器
        const container = document.getElementById('poetry-container');

        // 读取诗歌数据
        fetch('data.txt')
            .then(response => response.text())
            .then(data => {
                // 使用正则表达式分割诗歌，确保每首诗都是从@开始
                const poems = data.match(/@[\s\S]*?(?=@|$)/g);
                poems.forEach(poem => {
                    // 分离标题、时间和内容
                    const lines = poem.split('\n').filter(line => line.trim() !== '');
                    let title = '';
                    let time = 'unknown'; // 默认设为"unknown"
                    let content = '';

                    // 第一行是标题
                    title = lines.shift().substring(1).trim();

                    // 检查第二行是否是时间信息
                    if (lines.length > 0 && lines[0].startsWith('$')) {
                        time = lines.shift().substring(1).trim();
                    }

                    // 剩余行构成内容
                    content = lines.join('\n');
                    const card = createPoetryCard(title, content, time);
                    container.appendChild(card);
                });
            })
            .catch(error => console.error('Error loading poetry:', error));

        function createPoetryCard(title, content, time) {
            const card = document.createElement('div');
            card.className = 'poetry-card';

            let isMouseDown = false;
            let mouseDownX = 0;
            let mouseDownY = 0;
            const threshold = 5; // 设置阈值

            card.addEventListener('mousedown', (event) => {
                isMouseDown = true;
                mouseDownX = event.clientX;
                mouseDownY = event.clientY;
            });

            card.addEventListener('mouseup', (event) => {
                if (isMouseDown && Math.abs(event.clientX - mouseDownX) < threshold && Math.abs(event.clientY - mouseDownY) < threshold) {
                    toggleContent(card);
                }
                isMouseDown = false;
            });

            const titleElement = document.createElement('div');
            titleElement.className = 'card-title';
            titleElement.textContent = title;
            card.appendChild(titleElement);

            // 添加时间信息
            const timeElement = document.createElement('div');
            timeElement.className = 'card-time';
            timeElement.textContent = time;
            card.appendChild(timeElement);

            const contentElement = document.createElement('div');
            contentElement.className = 'card-content';
            contentElement.innerHTML = `<p>${content.replace(/\n/g, '<br>')}</p>`;
            card.appendChild(contentElement);

            return card;
        }

        function toggleContent(card) {
            const content = card.querySelector('.card-content');
            if (content.style.display === 'none' || content.style.display === '') {
                content.style.display = 'block';
            } else {
                content.style.display = 'none';
            }
        }
    </script>
</body>

</html>